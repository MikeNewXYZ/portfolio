---
import { Icon } from "astro-icon/components";
---

<div class="absolute inset-0 -z-10 h-dvh w-full overflow-hidden" style="perspective: 1000px;">
	<!-- ANCHOR Fade Out Overlay -->
	<div id="fade-out-overlay" class="absolute left-0 top-0 z-30 h-full w-full"></div>

	<!-- ANCHOR Vignette Overlay -->
	<div id="vignette-overlay" class="absolute left-0 top-0 z-20 h-full w-full"></div>

	<!-- ANCHOR Star Wrapper -->
	<div id="star-wrapper" class="absolute left-0 top-0 z-10 h-full w-full text-3xl antialiased">
		<Icon id="star" name="ph:shooting-star-fill" class="absolute -translate-x-16 translate-y-16" />
		<Icon id="star" name="ph:shooting-star-fill" class="-translate-y-20 absolute -translate-x-4" />
		<Icon id="star" name="ph:shooting-star-fill" class="translate-x-32 absolute" />
	</div>

	<!-- ANCHOR Background -->
	<div id="background" class="h-full w-full"></div>
</div>

<script>
	const starElements = [...document.querySelectorAll<SVGElement>("#star")!];
	const starRotation = calcRotation();

	starElements.map((starElement) => (starElement.style.rotate = `${starRotation}deg`));

	function calcRotation() {
		const DEFAULT_ANGLE = 45;
		const acute = (Math.atan(window.innerWidth / window.innerHeight) * 180) / Math.PI;
		return acute + 180 - DEFAULT_ANGLE;
	}
</script>

<style>
	#fade-out-overlay {
		background-image: linear-gradient(
			to top,
			theme(colors.secondary / 100%) 0%,
			theme(colors.secondary / 30%) 10%,
			theme(colors.secondary / 5%) 20%,
			theme(colors.secondary / 0%) 100%
		);
	}
	#vignette-overlay {
		background-image: radial-gradient(
			ellipse at center,
			theme(colors.secondary / 0%) 0%,
			theme(colors.secondary / 10%) 50%,
			theme(colors.secondary / 100%) 90%,
			theme(colors.secondary / 100%) 100%
		);
	}

	#star {
		display: block;
		top: 1000%;
		right: 1000%;
	}
	#star-wrapper {
		filter: drop-shadow(-10px -30px 0 theme(colors.primary / 15%));
		animation: dotted-background-transform 100s ease-in-out 0s infinite alternate;
	}
	#star-wrapper > :nth-child(1) {
		animation:
			dotted-background-star 28s linear 3s infinite,
			dotted-background-pulse 0.5s ease-in-out 1s infinite alternate;
	}
	#star-wrapper > :nth-child(2) {
		animation:
			dotted-background-star 30s linear 7s infinite,
			dotted-background-pulse 0.5s ease-in-out 0s infinite alternate;
	}
	#star-wrapper > :nth-child(3) {
		animation:
			dotted-background-star 32s linear 4s infinite,
			dotted-background-pulse 0.5s ease-in-out 2s infinite alternate;
	}

	#background {
		background-image: radial-gradient(theme(colors.primary / 50%) 1px, transparent 0);
		background-size: 40px 40px;
		transform: rotateX(0deg) rotateY(0deg) scale(1.25);
		animation:
			dotted-background-transform 100s ease-in-out 0s infinite alternate,
			dotted-background-scroll 70s linear infinite;
	}

	@keyframes dotted-background-fadeIn {
		0% {
			opacity: 0;
		}
		100% {
			opacity: 1;
		}
	}
	@keyframes dotted-background-pulse {
		0% {
			opacity: 0.5;
		}
		100% {
			opacity: 1;
		}
	}
	@keyframes dotted-background-star {
		0% {
			top: 0%;
			right: 0%;
		}
		20%,
		100% {
			top: 110%;
			right: 110%;
		}
	}
	@keyframes dotted-background-scroll {
		0% {
			background-position: 0% 0%;
		}
		100% {
			background-position: 0% 100%;
		}
	}
	@keyframes dotted-background-transform {
		0% {
			transform: rotateX(0deg) rotateY(0deg) scale(1.25);
		}
		12.5% {
			transform: rotateX(10deg) rotateY(0deg) scale(1.25);
		}
		25% {
			transform: rotateX(10deg) rotateY(10deg) scale(1.5);
		}
		37.5% {
			transform: rotateX(0deg) rotateY(10deg) scale(1.25);
		}
		50% {
			transform: rotateX(0deg) rotateY(0deg) scale(1.25);
		}
		62.5% {
			transform: rotateX(-10deg) rotateY(0deg) scale(1.5);
		}
		75% {
			transform: rotateX(-10deg) rotateY(-10deg) scale(1.25);
		}
		87.5% {
			transform: rotateX(0deg) rotateY(-10deg) scale(1.25);
		}
		100% {
			transform: rotateX(0deg) rotateY(0deg) scale(1.5);
		}
	}
</style>
